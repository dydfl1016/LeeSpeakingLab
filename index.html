<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kelly Speaking Lab - Full</title>

<style>
body{
  font-family:sans-serif;
  background:#f4f6f8;
  display:flex;
  justify-content:center;
  padding:20px;
}
.container{
  max-width:520px;
  width:100%;
  background:white;
  padding:25px;
  border-radius:20px;
  box-shadow:0 10px 25px rgba(0,0,0,0.1);
  text-align:center;
}
h2{margin-bottom:10px;}
.prompt{
  font-size:1.2rem;
  font-weight:bold;
  color:#1e4fa3;
  margin:15px 0;
}
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  margin-top:8px;
  font-weight:bold;
  cursor:pointer;
}
.black{background:#111;color:white;}
.green{background:#2ecc71;color:white;}
.blue{background:#2e6bd1;color:white;}
.purple{background:#6c5ce7;color:white;}
.orange{background:#ff8c42;color:white;}

textarea{
  width:100%;
  height:80px;
  margin-top:10px;
  border-radius:10px;
  padding:10px;
  border:1px solid #ddd;
}

.result{
  background:#f1f5ff;
  padding:15px;
  margin-top:15px;
  border-radius:10px;
  text-align:left;
}

.word-box{
  display:inline-block;
  padding:8px 12px;
  margin:5px;
  background:#eee;
  border-radius:20px;
  cursor:pointer;
}

.selected{
  background:#2e6bd1;
  color:white;
}
</style>
</head>

<body>
<div class="container">

<h2>ë¦¬ì˜ì–´ ìŠ¤í”¼í‚¹ ë©</h2>

<button class="black" onclick="setMode('speaking')">ğŸ¤ ë§í•˜ê¸° ëª¨ë“œ</button>
<button class="orange" onclick="setMode('unscramble')">ğŸ§© ìˆœì„œ ë§ì¶”ê¸° ëª¨ë“œ</button>

<div id="mainArea" style="margin-top:20px;"></div>

</div>

<script>

// =====================
// ğŸ“š ë°ì´í„° ì „ì²´ í†µí•©
// =====================

const speakingData = [
  // Unit 9
  {ko:"ë‚˜ëŠ” ìº í”„ì—ì„œ ìƒˆ ì¹œêµ¬ë“¤ì„ ë§Œë‚œë‹¤.", en:"I meet new friends at camp."},
  {ko:"ì•„ìƒ¤ëŠ” ë‚¨ì•„í”„ë¦¬ì¹´ì—ì„œ ì™”ë‹¤.", en:"Asha is from South Africa."},
  {ko:"ì§„ì€ í•œêµ­ì—ì„œ ì™”ë‹¤.", en:"Jin is from Korea."},
  {ko:"ë¯¸ì•„ëŠ” ëŸ¬ì‹œì•„ì—ì„œ ì™”ë‹¤.", en:"Mia is from Russia."},
  {ko:"í›„ì•ˆì€ ë©•ì‹œì½”ì—ì„œ ì™”ë‹¤.", en:"Juan is from Mexico."},
  {ko:"ììŠ¤ë¯¼ì€ ì¸ë„ì—ì„œ ì™”ë‹¤.", en:"Jasmin is from India."},
  {ko:"ë‚˜ëŠ” ë¯¸êµ­ì—ì„œ ì™”ë‹¤.", en:"I am from the U.S."},
  {ko:"ìš°ë¦¬ëŠ” ëª¨ë‘ ì¹œêµ¬ì•¼.", en:"We are all friends."},

  // Unit 10
  {ko:"ì—¬ê¸° ëˆˆìœ¼ë¡œ ì“¸ ê·¸ë¦°ë¹ˆì´ ìˆì–´.", en:"Here are green beans for eyes."},
  {ko:"ì—¬ê¸° ì½”ë¡œ ì“¸ ë”¸ê¸°ê°€ ìˆì–´.", en:"Here is a strawberry for a nose."},
  {ko:"ì—¬ê¸° ì…ìˆ ë¡œ ì“¸ í•«ë„ê·¸ê°€ ìˆì–´.", en:"Here is a hot dog for lips."},
  {ko:"ì—¬ê¸° ë¨¸ë¦¬ì¹´ë½ìœ¼ë¡œ ì“¸ ìŠ¤íŒŒê²Œí‹°ê°€ ìˆì–´.", en:"Here is spaghetti for hair."},
  {ko:"ë‚´ íŒ¬ì¼€ì´í¬ë¥¼ ë´.", en:"Look at my pancake."},
  {ko:"ì´ê±´ ìš°ë¦¬ ì—„ë§ˆ ì–¼êµ´ì´ì•¼!", en:"It is my momâ€™s face!"}
];

const unscrambleData = [
  {words:["on","An apple","the desk","is"], answer:"An apple is on the desk."},
  {words:["The dogs","in","are","the house"], answer:"The dogs are in the house."},
  {words:["under","are","the table","The oranges"], answer:"The oranges are under the table."},
  {words:["the door","behind","A cat","is"], answer:"A cat is behind the door."},
  {words:["My friends","next to","are","the bus"], answer:"My friends are next to the bus."}
];

let currentMode="";
let currentIndex=0;
let selectedWords=[];

// =====================
// ğŸ¤ ëª¨ë“œ ì„¤ì •
// =====================

function setMode(mode){
  currentMode=mode;
  document.getElementById("mainArea").innerHTML="";
  if(mode==="speaking") loadSpeaking();
  if(mode==="unscramble") loadUnscramble();
}

// =====================
// ğŸ¤ ë§í•˜ê¸° ëª¨ë“œ
// =====================

function loadSpeaking(){
  nextSpeaking();

  document.getElementById("mainArea").innerHTML+=`
  <button class="black" onclick="nextSpeaking()">ìƒˆ ë¬¸ì¥</button>
  <button class="green" onclick="toggleRecording()">ë…¹ìŒ ì‹œì‘/ì¤‘ì§€</button>
  <button class="blue" onclick="startSTT()">STT ì‹œì‘</button>
  <audio id="audioPlayback" controls style="width:100%; margin-top:10px;"></audio>
  <textarea id="sttResult"></textarea>
  <button class="purple" onclick="evaluate()">AI ê°„ë‹¨ í‰ê°€</button>
  <div id="feedback" class="result" style="display:none;"></div>
  `;
}

function nextSpeaking(){
  currentIndex=Math.floor(Math.random()*speakingData.length);
  document.getElementById("mainArea").innerHTML=
  `<div class="prompt">${speakingData[currentIndex].ko}</div>`;
}

let mediaRecorder;
let audioChunks=[];

function toggleRecording(){
  if(!mediaRecorder || mediaRecorder.state==="inactive"){
    navigator.mediaDevices.getUserMedia({audio:true})
    .then(stream=>{
      mediaRecorder=new MediaRecorder(stream);
      mediaRecorder.start();
      audioChunks=[];
      mediaRecorder.ondataavailable=e=>audioChunks.push(e.data);
      mediaRecorder.onstop=()=>{
        const blob=new Blob(audioChunks,{type:"audio/webm"});
        document.getElementById("audioPlayback").src=
        URL.createObjectURL(blob);
      };
    });
  } else {
    mediaRecorder.stop();
  }
}

function startSTT(){
  const recognition=new webkitSpeechRecognition();
  recognition.lang="en-US";
  recognition.start();
  recognition.onresult=function(event){
    document.getElementById("sttResult").value=
    event.results[0][0].transcript;
  };
}

function evaluate(){
  const user=document.getElementById("sttResult").value.toLowerCase();
  const answer=speakingData[currentIndex].en.toLowerCase();
  const keywords=answer.replace(/[^\w\s]/g,'').split(" ");

  let score=0;
  keywords.forEach(word=>{
    if(user.includes(word)) score++;
  });

  const percent=Math.round(score/keywords.length*100);

  document.getElementById("feedback").style.display="block";
  document.getElementById("feedback").innerHTML=
  `<b>ëª¨ë²” ë¬¸ì¥:</b> ${speakingData[currentIndex].en}<br><br>
   <b>ì ìˆ˜:</b> ${percent}/100`;
}

// =====================
// ğŸ§© ìˆœì„œ ë§ì¶”ê¸° ëª¨ë“œ
// =====================

function loadUnscramble(){
  currentIndex=Math.floor(Math.random()*unscrambleData.length);
  selectedWords=[];
  renderUnscramble();
}

function renderUnscramble(){
  const data=unscrambleData[currentIndex];
  let html=`<div class="prompt">ë‹¨ì–´ë¥¼ ëˆŒëŸ¬ ìˆœì„œë¥¼ ë§ì¶°ë³´ì„¸ìš”</div>`;

  data.words
  .sort(()=>Math.random()-0.5)
  .forEach(word=>{
    html+=`<div class="word-box" onclick="selectWord(this,'${word}')">${word}</div>`;
  });

  html+=`
  <div style="margin-top:15px;"><b>ë‚´ ë¬¸ì¥:</b> <span id="sentenceArea"></span></div>
  <button class="purple" onclick="checkAnswer()">ì •ë‹µ í™•ì¸</button>
  <div id="unscrambleResult" class="result" style="display:none;"></div>
  `;

  document.getElementById("mainArea").innerHTML=html;
}

function selectWord(element,word){
  selectedWords.push(word);
  element.classList.add("selected");
  element.onclick=null;
  document.getElementById("sentenceArea").innerText=
  selectedWords.join(" ");
}

function checkAnswer(){
  const userSentence=selectedWords.join(" ").trim();
  const correct=unscrambleData[currentIndex].answer;

  const result=document.getElementById("unscrambleResult");
  result.style.display="block";

  if(userSentence===correct.replace(".","")){
    result.innerHTML="âœ… ì •ë‹µì…ë‹ˆë‹¤!";
  } else {
    result.innerHTML=`âŒ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”!<br><br>ì •ë‹µ: ${correct}`;
  }
}

</script>
</body>
</html>
